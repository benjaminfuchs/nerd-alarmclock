#!/usr/bin/python3
# --------------------------------------------------------------------------
# Class definition of RestartController - utility functions for the tank
#
# Author: Benjamin Fuchs
# License: GPL3
#
# Website: https://github.com/benjaminfuchs/who_disposer
#
# --------------------------------------------------------------------------

import time

from nclock.Buzzer import Buzzer


class RestartController():
    """ RestartController thread """

    POLL_INTERVAL = 1

    def __init__(self, settings):
        """ Constructor """

        self._settings = settings
        self._settings.log.msg("RestartController: init")
        self._start_time = 0
        settings.add_settings_listener('button.status', self.on_button)

    def on_button(self, name, old, new):
        """ process button changes """

        if new == "on":
            self._start_time = time.time()
        elif new == "off":
            if time.time() - self._start_time >= 3:
                subprocess.call("sudo systemctl restart nerd-dispenser.service", shell=True)